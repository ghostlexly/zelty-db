generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"

  // Optional Prisma Client Generator configuration
  runtime                = "nodejs"
  moduleFormat           = "cjs"
  generatedFileExtension = "ts"
}

datasource db {
  provider = "postgresql"
}

model ZeltyRestaurant {
  id                   String   @id @default(uuid())
  zeltyId              Int      @unique
  remoteId             String?
  disable              Boolean  @default(false)
  name                 String
  description          String?
  countryCode          String   @default("FR")
  currency             String   @default("EUR")
  image                String?
  defaultLang          String   @default("fr")
  productionDelay      Int      @default(0)
  deliveryTime         Int      @default(0)
  orderingAvailable    Boolean  @default(true)
  deliveryCharge       Decimal  @default(0) @db.Decimal(10, 2)
  deliveryChargeTva    Decimal  @default(0) @db.Decimal(5, 2)
  deliveryMinimum      Decimal  @default(0) @db.Decimal(10, 2)
  deliveryNoChargeMin  Decimal  @default(0) @db.Decimal(10, 2)
  deliveryHours        Json?
  openingHours         Json?
  openingHoursTxt      String?
  happyHours           Json?
  closures             Json     @default("[]")
  address              String?
  phone                String?
  publicName           String?
  onlineOrderingHidden Boolean  @default(false)
  latitude             Decimal? @db.Decimal(10, 7)
  longitude            Decimal? @db.Decimal(10, 7)
  takeawayDelay        Int      @default(0)
  orderingDelay        Boolean  @default(false)
  delay                Int      @default(0)
  meta                 Json?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  orders ZeltyOrder[]
  dishes ZeltyDish[]
}

model ZeltyOrder {
  id                String    @id @default(uuid())
  zeltyId           Int       @unique
  zeltyUuid         String    @unique
  comment           String?
  deviceId          Int?
  closedByDeviceId  Int?
  remoteId          String?
  ref               String?
  loyalty           Int       @default(0)
  seats             Int       @default(1)
  tableNumber       Int?
  zeltyRestaurantId Int
  zeltyCreatedAt    DateTime
  closedAt          DateTime?
  dueDate           DateTime?
  mode              String?
  fulfillmentType   String?
  source            String?
  originName        String?
  status            String
  amountIncTax      Int       @default(0)
  amountExcTax      Int       @default(0)
  virtualBrandName  String?
  firstName         String?
  phone             String?
  buzzerRef         String?
  displayId         String?
  channel           String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  restaurant ZeltyRestaurant @relation(fields: [zeltyRestaurantId], references: [zeltyId])
  items      ZeltyOrderItem[]

  @@index([zeltyRestaurantId])
  @@index([status])
  @@index([zeltyCreatedAt])
}

model ZeltyDish {
  id                 String   @id @default(uuid())
  zeltyId            Int      @unique
  zeltyRestaurantId  Int
  remoteId           String?
  sku                String?
  name               String
  description        String?
  image              String?
  thumb              String?
  price              Int      @default(0)
  priceTogo          Int?
  priceDelivery      Int?
  happyPrice         Int?
  costPrice          Int?
  tax                Int      @default(0)
  taxTakeaway        Int?
  taxDelivery        Int?
  tags               Json     @default("[]")
  options            Json     @default("[]")
  fabricationPlaceId Int?
  color              String?
  loyaltyPoints      Int      @default(0)
  earnLoyalty        Int      @default(0)
  priceToDefine      Boolean  @default(false)
  disable            Boolean  @default(false)
  disableTakeaway    Boolean  @default(false)
  disableDelivery    Boolean  @default(false)
  meta               Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  restaurant ZeltyRestaurant @relation(fields: [zeltyRestaurantId], references: [zeltyId])
  orderItems ZeltyOrderItem[]

  @@index([zeltyRestaurantId])
  @@index([disable])
}

model ZeltyOrderItem {
  id                    String  @id @default(uuid())
  zeltyId               Int     @unique
  zeltyOrderId          Int
  zeltyDishId           Int
  name                  String
  type                  String
  course                Int     @default(0)
  comment               String?
  baseOriginalAmountIncTax Int  @default(0)
  originalAmountIncTax  Int     @default(0)
  discountedAmountIncTax Int    @default(0)
  finalAmountIncTax     Int     @default(0)
  taxAmount             Int     @default(0)
  taxRate               Int?
  modifiers             Json    @default("[]")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  order ZeltyOrder @relation(fields: [zeltyOrderId], references: [zeltyId])
  dish  ZeltyDish  @relation(fields: [zeltyDishId], references: [zeltyId])

  @@index([zeltyOrderId])
  @@index([zeltyDishId])
}
